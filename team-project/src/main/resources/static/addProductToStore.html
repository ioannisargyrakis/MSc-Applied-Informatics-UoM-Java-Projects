<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>

<!DOCTYPE html>
<html lang="el">
<head>
    <meta charset="UTF-8">
    <title>Προσθήκη Προϊόντος</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="login-container">
        <h2>Προσθήκη Νέου Προϊόντος</h2>
        
        <div class="store-info" id="storeInfo">
            ΑΦΜ Καταστήματος: <strong id="storeAfmDisplay"></strong>
        </div>

        <div id="messageArea"></div>
        
        <form id="addProductForm">
            <label> 
                Τύπος Προϊόντος: 
                <input type="text" id="type" required> 
            </label>
            
            <label> 
                Μάρκα: 
                <input type="text" id="brand" required> 
            </label>
            
            <label> 
                Τιμή (€): 
                <input type="number" step="1" id="price" min="0" required> 
            </label>
            
            <label> 
                Περιγραφή: 
                <textarea id="description"></textarea>
            </label>
            <br>
            <label> 
                Αριθμός Τεμαχίων: 
                <input type="number" id="numberOfProducts" value="1" min="1" required> 
            </label>
            
            <button type="submit">Προσθήκη Προϊόντος</button>
        </form>

        <nav>
            <a href="#" id="backBtn" class="back-btn">Επιστροφή στο Κατάστημα</a>
        </nav>
    </div>

    <script>
        // Get store AFM from URL
        const urlParams = new URLSearchParams(window.location.search);
        const storeAfm = urlParams.get('storeAfm') || '121212121';

        // Set back button and display AFM
        document.getElementById('backBtn').href = 'storeLandingPage.html?storeAfm=' + storeAfm;
        document.getElementById('storeAfmDisplay').textContent = storeAfm;

        // Load store name
        $(document).ready(function() {
            loadStoreName();
        });

        function loadStoreName() {
            $.ajax({
                url: "http://localhost:8080/store/" + storeAfm + "/products",
                method: "GET",
                success: function(response) {
                    if (response.length > 0 && response[0].store) {
                        $("#storeName").text(response[0].store.shopName);
                    } else {
                        $("#storeName").text("ΑΦΜ: " + storeAfm);
                    }
                },
                error: function() {
                    $("#storeName").text("ΑΦΜ: " + storeAfm);
                }
            });
        }

        // Handle form submission
        $('#addProductForm').on('submit', function(e) {
            e.preventDefault();
            addProduct();
        });

        function addProduct() {
            // Get form values
            var type = document.getElementById("type").value.trim();
            var brand = document.getElementById("brand").value.trim();
            var price = parseFloat(document.getElementById("price").value);
            var description = document.getElementById("description").value.trim();
            var numberOfProducts = parseInt(document.getElementById("numberOfProducts").value);

            // Validation
            if (!type || !brand) {
                showMessage("Παρακαλώ συμπληρώστε όλα τα υποχρεωτικά πεδία", "error");
                return;
            }

            if (price <= 0) {
                showMessage("Η τιμή πρέπει να είναι μεγαλύτερη από 0", "error");
                return;
            }

            if (numberOfProducts < 1) {
                showMessage("Ο αριθμός τεμαχίων πρέπει να είναι τουλάχιστον 1", "error");
                return;
            }

            // Prepare product data
            var productData = {
                type: type,
                brand: brand,
                price: price,
                description: description,
                numberOfProducts: numberOfProducts
            };

            // Disable submit button
            var submitBtn = $('#addProductForm button[type="submit"]');
            submitBtn.prop('disabled', true).text('Προσθήκη...');

            // Send AJAX request
            $.ajax({
                url: "http://localhost:8080/store/" + storeAfm + "/addProduct",
                method: "POST",
                contentType: "application/json",
                data: JSON.stringify(productData),
                success: function(response) {
                    showMessage(response, "success");
                    document.getElementById("addProductForm").reset();
                    submitBtn.prop('disabled', false).text('Προσθήκη Προϊόντος');
                },
                error: function(jqXHR) {
                    var errorMsg = jqXHR.responseText || "Αποτυχία προσθήκης προϊόντος";
                    showMessage(errorMsg, "error");
                    submitBtn.prop('disabled', false).text('Προσθήκη Προϊόντος');
                }
            });
        }

        function showMessage(message, type) {
            var messageClass = type === "success" ? "message success" : "message error";
            $("#messageArea").html('<div class="' + messageClass + '">' + message + '</div>');
            
            // Auto-hide message after 5 seconds
            setTimeout(function() {
                $("#messageArea").fadeOut(function() {
                    $(this).html('').show();
                });
            }, 5000);
        }
    </script>

</body>
</html>